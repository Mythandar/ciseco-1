<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0522)http://webcache.googleusercontent.com/search?ion=1&sourceid=chrome-psyapi2&q=cache%3Ahttp%3A%2F%2Fopenmicros.org%2Findex.php%2Farticles%2F85-llap-lightweight-local-automation-protocol%2F102-aprotocolxrf-mousetrap&oq=cache%3Ahttp%3A%2F%2Fopenmicros.org%2Findex.php%2Farticles%2F85-llap-lightweight-local-automation-protocol%2F102-aprotocolxrf-mousetrap&ie=UTF-8&aqs=chrome..69i57j69i58.873j0j4&bav=on.2,or.r_cp.&biw=1745&bih=814&dpr=1.1&ech=1&psi=H6_BV9RVktGwAdmWnbAI.1472311073270.3&ei=H6_BV9RVktGwAdmWnbAI&emsg=NCSR&noj=1 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--<base href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap">--><base href="."><style type="text/css">body { margin-left:0;margin-right:0;margin-top:0; }#google-cache-hdr {background:#f5f5f5 !important;font:13px arial,sans-serif !important;text-align:left !important;color:#202020 !important;border:0 !important;margin:0 !important;border-bottom:1px solid #cecece !important;line-height:16px !important ;padding:16px 28px 24px 28px !important;}#google-cache-hdr * {display:inline !important;font:inherit !important;text-align:inherit !important;color:inherit !important;line-height:inherit !important;background:none !important;border:0 !important;margin:0 !important;padding:0 !important;letter-spacing:0 !important;}#google-cache-hdr a {text-decoration:none !important;color:#1a0dab !important;}#google-cache-hdr a:hover { text-decoration:underline !important; }#google-cache-hdr a:visited { color:#609 !important; }#google-cache-hdr div { display:block !important;margin-top:4px !important; }#google-cache-hdr b {font-weight:bold !important;display:inline-block !important;direction:ltr !important;}</style><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head><body><div id="google-cache-hdr" dir="ltr"><div>This is Google's cache of <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap" dir="ltr">http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap</a>. It is a snapshot of the page as it appeared on Jul 17, 2016 15:52:48 GMT. </div><div>The <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap" dir="ltr">current page</a> could have changed in the meantime. <a href="http://support.google.com/websearch/bin/answer.py?hl=en&amp;p=cached&amp;answer=1687222">Learn more</a></div><div></div><div><span style="display:inline-block !important;margin-top:8px !important;margin-right:104px !important;white-space:nowrap !important;"><span style="margin-right:28px !important;"><span style="font-weight:bold !important;">Full version</span></span><span style="margin-right:28px !important;"><a href="http://webcache.googleusercontent.com/search?q=cache:http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap&amp;num=1&amp;biw=1745&amp;bih=814&amp;noj=1&amp;strip=1&amp;vwsrc=0">Text-only version</a></span><span style="margin-right:28px !important;"><a href="http://webcache.googleusercontent.com/search?q=cache:http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap&amp;num=1&amp;biw=1745&amp;bih=814&amp;noj=1&amp;strip=0&amp;vwsrc=1">View source</a></span></span><span style="display:inline-block !important;margin-top:8px !important;color:#717171 !important;">Tip: To quickly find your search term on this page, press <b>Ctrl+F</b> or <b>âŒ˜-F</b> (Mac) and use the find bar.</span></div></div><div style="position:relative;">




  <!--<base href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap">--><base href=".">
  
  <meta name="robots" content="index, follow">
  <meta name="keywords" content="XRFaProtocolaPLLAP">
  <meta name="rights" content="">
  <meta name="language" content="en-GB">
  <meta name="title" content="LLAP / XRF Mousetrap">
  <meta name="author" content="Andrew Lindsay">
  <meta name="description" content="LLAP / XRF mousetrap">
  <meta name="generator" content="Joomla! 1.6 - Open Source Content Management">
  <title>LLAP / XRF Mousetrap</title>
  <script src="./LLAP _ XRF Mousetrap_files/core.js" type="text/javascript"></script>
  <script src="./LLAP _ XRF Mousetrap_files/mootools-core.js" type="text/javascript"></script>
  <script src="./LLAP _ XRF Mousetrap_files/caption.js" type="text/javascript"></script>
  <script src="./LLAP _ XRF Mousetrap_files/mootools-more.js" type="text/javascript"></script>

<link rel="stylesheet" href="./LLAP _ XRF Mousetrap_files/system.css" type="text/css">
<link rel="stylesheet" href="./LLAP _ XRF Mousetrap_files/general.css" type="text/css">
<link rel="stylesheet" href="./LLAP _ XRF Mousetrap_files/template.css" type="text/css">
<link rel="stylesheet" href="./LLAP _ XRF Mousetrap_files/grey.css" type="text/css">
<!--[if IE 6]>
<link rel="stylesheet" href="/templates/a4joomla-thirty-three/css/ie6.css" type="text/css" />
<script src="/templates/a4joomla-thirty-three/js/suckerfish.js" type="text/javascript"></script>
<style type="text/css">
img, div, a, input { behavior: url(/templates/a4joomla-thirty-three/iepngfix.htc) }
</style>
<script src="/templates/a4joomla-thirty-three/js/iepngfix_tilebg.js" type="text/javascript"></script>
<![endif]-->
<!--[if lte IE 7]>
<link rel="stylesheet" href="/templates/a4joomla-thirty-three/css/ie67.css" type="text/css" />
<![endif]-->
<script type="text/javascript" src="./LLAP _ XRF Mousetrap_files/mod_stat.php"></script>
<style type="text/css">
 #header {
    height: 80px;
 }
 #allwrap {
    margin-top:0px;
 }
 #logo {
    width:440px;
    height:80px;
 }
 #logo h2 {
    font-size:52px;
	margin-top:0px;
 }
 #logo h3 {
	margin-top:-10px;
 }
 #banner {
    height: 80px;
 }
 #banner div.moduletable {
	margin-top:10px;
 }
 #headerright {
    width:530px;
    height:80px;
	       background: none;   
     } 
 #search {
   width:170px;
   height:32px;
 }
 
</style>
<!-- <script src="/templates/a4joomla-thirty-three/js/equalize.js" type="text/javascript"></script> -->





<div id="allwrap" class="gainlayout" style="width:1030px;">

<div id="headerwrap" class="gainlayout">
  <div id="header" class="gainlayout">   
      <div id="logo" class="gainlayout">
         		    <a href="http://openmicros.org/"><img src="./LLAP _ XRF Mousetrap_files/openmicroslogo.png" border="0" alt=""></a>
          
      </div>
	  <div id="headerright" class="gainlayout">
                <div class="clr"></div>
      </div>
      <div class="clr"></div>
  </div>	  
  <div class="clr"></div>
</div>

<div id="topmenuwrap" class="gainlayout">
           <div id="topmenu" class="gainlayout">
           		<div class="moduletable">
					<h3>Top</h3>
					
<ul class="menusfh">
<li id="item-464"><a href="http://openmicros.org/">Home</a></li><li id="item-540"><a href="http://openmicros.org/index.php/documentation">documentation</a></li><li id="item-486"><a href="http://openmicros.org/index.php/component/kunena/?Itemid=0">FORUM</a></li><li id="item-484" class="current active"><a href="http://openmicros.org/index.php/articles">Articles by list</a></li><li id="item-490"><a href="http://openmicros.org/index.php/search">forum search</a></li><li id="item-541"><a href="http://wirelessthings.net/" target="_blank">WirelessThings Shop</a></li></ul>		</div>
	
           <div class="clr"></div>
         </div> 
            <div id="search" class="gainlayout">
          		<div class="moduletable">
					<h3>Search</h3>
					<form action="http://openmicros.org/index.php/articles" method="post">
	<div class="search">
		<label for="mod-search-searchword">Search...</label><input name="searchword" id="mod-search-searchword" maxlength="20" class="inputbox" type="text" size="20" value="Search..." onblur="if (this.value==&#39;&#39;) this.value=&#39;Search...&#39;;" onfocus="if (this.value==&#39;Search...&#39;) this.value=&#39;&#39;;" data-cip-id="mod-search-searchword">	<input type="hidden" name="task" value="search">
	<input type="hidden" name="option" value="com_search">
	<input type="hidden" name="Itemid" value="484">
	</div>
</form>
		</div>
	 
		<div class="clr"></div>  
        </div>
    <div class="clr"></div>
</div> 

<div id="wrap" class="gainlayout">

  	  <div id="pathway" class="gainlayout">
        
<div class="breadcrumbs">
<span class="showHere">You are here: </span><a href="http://openmicros.org/" class="pathway">Home</a> <img src="./LLAP _ XRF Mousetrap_files/arrow.png" alt=""> <a href="http://openmicros.org/index.php/articles" class="pathway">Articles by list</a> <img src="./LLAP _ XRF Mousetrap_files/arrow.png" alt=""> <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol" class="pathway">LLAP - Lightweight Local Automation Protocol</a> <img src="./LLAP _ XRF Mousetrap_files/arrow.png" alt=""> <span>LLAP / XRF Mousetrap</span></div>
<p style="display:none">Get the facts on cervical cancer. Dean <i>how can i buy cialis online</i> the School of Obstetrics at the University of Brescia. But what concerns many of the people buying these how can i buy cialis online from black market sources is that they have no available or affordable how can i buy cialis online. These include blood cells, which fight infection, cause the blood to clot, and carry oxygen to all parts of the body. <a href="http://www.buycialisdailyonline.com/" alt="how much does cialis cost">buying cialis online safe</a> Takeda Pharmaceuticals (Philippines), we considerIf you have turned 15, you can buy OTC <strong>cialis black</strong> in dispensing groups HF, HX or HV (explained below) outside pharmacies. Note We only ship within the USA and do not import or export. Aliskiren is a renin inhibitor, prescribed for hypertension. Not Finding What You're Looking For. Please contact customer service if you continue to experience problems.</p>
<p style="display:none"><a href="http://alevelwriter.com/write_my_philosophy_education_paper.html">write my philosophy education paper</a></p>
<p style="display:none"><a href="http://alevelwriter.com/write_my_philosophy_paper.html">write my philosophy paper</a></p>
<p style="display:none"><a href="http://alevelwriter.com/write_my_psychology_paper.html">write my psychology paper</a></p>

      <div class="clr"></div>
	  </div>
   
    <div id="cbody" class="gainlayout">
    <div id="content60" style="width:988px;">    

	    
      <div id="content" class="gainlayout">
	  
      <div class="item-page">
		<h2>
								<a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap">
						LLAP / XRF Mousetrap</a>
						</h2>


		<ul class="actions">
		<li class="print-icon"><a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap?tmpl=component&amp;format=pdf" onclick="window.open(this.href,&#39;win2&#39;,&#39;status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no&#39;); return false;" title="PDF" rel="nofollow"><img src="./LLAP _ XRF Mousetrap_files/pdf_button.png" alt="PDF"></a></li>										<li class="print-icon">
						<a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/102-aprotocolxrf-mousetrap?tmpl=component&amp;print=1&amp;page=" title="Print" onclick="window.open(this.href,&#39;win2&#39;,&#39;status=no,toolbar=no,scrollbars=yes,titlebar=no,menubar=no,resizable=yes,width=640,height=480,directories=no,location=no&#39;); return false;" rel="nofollow"><img src="./LLAP _ XRF Mousetrap_files/printButton.png" alt="Print"></a>				</li>
				
								<li class="email-icon">
						<a href="http://openmicros.org/index.php/component/mailto/?tmpl=component&amp;template=a4joomla-thirty-three&amp;link=867651668a5f04725e1b925b2629967863bfb6a1" title="Email" onclick="window.open(this.href,&#39;win2&#39;,&#39;width=400,height=350,menubar=yes,resizable=yes&#39;); return false;"><img src="./LLAP _ XRF Mousetrap_files/emailButton.png" alt="Email"></a>				</li>
												</ul>

	
	

 <dl class="article-info">
 <dt class="article-info-term">Details</dt>
		<dd class="category-name">
										Category: <a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol">LLAP - Lightweight Local Automation Protocol</a>						</dd>
		<dd class="modified">
		Last Updated on Tuesday, 15 November 2011 12:43		</dd>
	
 </dl>

	
	<p>I found I had a problem in my shed with mice over the winter. They had nested and dined on birdseed I had stored there. I thought they had gone but recently they have been back. I decided to set a trap for them. Not wanting to harm them or leave a trap unchecked I went for a high-tech solution. The trap is a basic baited tube that tilts to close the door and trap the mouse which can then be released some distance away from the house.</p><p>&nbsp;</p><p>The system uses a a Xino Basic for Atmel with a XFR module and XFR Shield.&nbsp; The trigger is a simple pair of contacts that ground the digital I/O pin 2 whew the trap is tripped. This then starts to transmit the LLAP message <em>aM1TRAPTRIG-</em>. The message is sent at one minute intervales until the Xino is reset. The message is picked up by a XRF/FTDI board connected to a Linux server running a simple perl script to listen for&nbsp;LAPP messages. When the message is received a Twitter updated is created once a mouse has been caught.</p><p>&nbsp;</p><h4>Messages</h4><p>Two messages are used in this example, the first is an initial indicator that the trap has been initialised, it is <em>aM1TRAPOK---</em></p><p>The main message for when the trap has been triggered is <em>aM1TRAPTRIG-</em>, this is sent continuously sent at aninterval of once per minute until the Xino is reset.</p><p>&nbsp;</p><h4>The following pictures show the trap being set up and in use.</h4><p>&nbsp;</p><p>The Trap:</p><p><img alt="Trap" src="./LLAP _ XRF Mousetrap_files/trap1.jpg"></p><p>&nbsp;</p><p>Trap was baited with peanut butter:</p><p><img alt="Baid" src="./LLAP _ XRF Mousetrap_files/trap2.jpg"></p><p>&nbsp;</p><p>Moving contact connected to digital pin 2:</p><p><img alt="Contact" src="./LLAP _ XRF Mousetrap_files/trap3.jpg"></p><p>&nbsp;</p><p>The moving contact is foil on the end of the trap. When it is tipped it makes contact with the lower contact, connected to ground, thus joining the circuit:</p><p><img alt="Both contacts" src="./LLAP _ XRF Mousetrap_files/trap4.jpg"></p><p>&nbsp;</p><p>Trap setup and activated:</p><p><img alt="Ready" src="./LLAP _ XRF Mousetrap_files/trap5.jpg"></p><p>&nbsp;</p><p>After seening a tweet, the trap was checked next morning:</p><p><img alt="Caught" src="./LLAP _ XRF Mousetrap_files/trap6.jpg"></p><p>&nbsp;</p><p>The mouse it had caught:</p><p><img alt="Mouse" src="./LLAP _ XRF Mousetrap_files/trap7.jpg"></p><p>&nbsp;</p><p>The trap was running for two nights and on both occasions it was triggered and a mouse caught.</p><p>&nbsp;</p><h4>Code</h4><p>The code comprises a small sketch to run on the Xino and a perl script to listen for the&nbsp;LAPP message.</p><p>Arduino/Xino Basic for Atmel sketch:</p><p>&nbsp;</p><pre class="brush:cpp">/* Simple Mousetrap sender using XFR modules to send LLAP messages to remote base station when trap is initialised and when the trap is sprung. XRF Moules used available from http://www.ciseco.co.uk/content/?page_id=1646 Technical details at http://www.ciseco.co.uk/content/?p=1738 By Andrew D. Lindsay, 8th June 2011 http://blog.thiseldo.co.uk Code was originally based on the Arduino debounce example. */ // Set the output used to enable the XRF module #define XRF_ENABLE 8 // Define the pin used as the trap sensor #define TRAP_PIN 2 // Variables will change: int buttonState; // the current reading from the input pin int lastButtonState = LOW; // the previous reading from the input pin // the following variables are long's because the time, measured in miliseconds, // will quickly become a bigger number than can be stored in an int. long lastDebounceTime = 0; // the last time the output pin was toggled long debounceDelay = 50; // the debounce time; increase if the output flickers boolean triggered = false; long lastNotice = 0; void setup() { // pinMode(TRAP_PIN, INPUT); digitalWrite( TRAP_PIN, HIGH); // start serial port pinMode( XRF_ENABLE, OUTPUT ); digitalWrite( XRF_ENABLE, HIGH ); Serial.begin(9600); delay(100); Serial.println( "aM1TRAPOK---" ); } void loop() { // read the state of the switch into a local variable: int reading = digitalRead(TRAP_PIN); // check to see if you just pressed the button // (i.e. the input went from LOW to HIGH), and you've waited // long enough since the last press to ignore any noise: // If the switch changed, due to noise or pressing: if (reading != lastButtonState) { // reset the debouncing timer lastDebounceTime = millis(); } if ((millis() - lastDebounceTime) &gt; debounceDelay) { // whatever the reading is at, it's been there for longer // than the debounce delay, so take it as the actual current state: buttonState = reading; if( !triggered &amp;&amp; buttonState == LOW) { triggered = true; // Send the initial notification that the trap has been sprung Serial.println( "aM1TRAPTRIG-" ); lastNotice = millis(); } } // If trap sprung then send notification every minute until reset if( triggered &amp;&amp; (lastNotice + 60000 &lt; millis()) ) { // Send the notification that the trap has been sprung Serial.println( "aM1TRAPTRIG-" ); lastNotice = millis(); } // save the reading. Next time through the loop, // it'll be the lastButtonState: lastButtonState = reading; } </pre><p>&nbsp;</p><p>Perl Script:</p><pre class="brush:perl">#!/usr/bin/perl -w # Reads data from a number of XRF LAPP devices via serial port. # # Andrew Lindsay http://blog.thiseldo.co.uk # use strict; use Device::SerialPort qw( :PARAM :STAT 0.07 ); use URI::Escape; # Alter these values to suit your configuration # Serial port CC128 connected to my $PORT = "/dev/ttyUSB0"; # supertweet.net values - basic auth proxy for twitter. my $twitterUser = "xxxxxxxxxxxxxxx"; my $twitterPass = "xxxxxxxxxx"; # End of configuration # Setup the serial port. my $ob = Device::SerialPort-&gt;new($PORT); $ob-&gt;baudrate(9600); $ob-&gt;write_settings; print "Reading XRF aProtocol datastream on $PORT\n"; open(SERIAL, "+&gt;$PORT"); my $haveTweeted = "N"; while (my $line = &lt;SERIAL&gt;) { print "$line\n"; if ($line =~ m!M1TRAPOK! ) { print "Trap initialised\n"; $haveTweeted = "N"; } if ($line =~ m!M1TRAPTRIG! ) { # process Mouse caught print "$line\n"; # Tweet mouse caught if( "$haveTweeted" eq "N" ) { $haveTweeted = "Y"; print "Tweet\n"; my $tweetstatus = uri_escape( "Trap M1 triggered - Check for mouse" ); system( "curl -s -u $twitterUser:$twitterPass -d 'status =$tweetstatus' http://api.supertweet.net/1/statuses/update.xml"); } } } </pre><p>&nbsp;</p><p>This example shows that something as simple as a mousetrap can be&nbsp;LAPP enabled. If you had a large building with many traps, you could use something like this to determine which ones had been tripped without having to visit each one in turn.</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> 
				<ul class="pagenav">
					<li class="pagenav-prev">
						<a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/112-llap" rel="next">&lt; Prev</a>
					</li>
					<li class="pagenav-next">
						<a href="http://openmicros.org/index.php/articles/85-llap-lightweight-local-automation-protocol/100-aprotocol-compression" rel="prev">Next &gt;</a>
					</li>
				</ul>
	</div> 
      </div> 
          
  </div>
      <div class="clr"></div>
  </div>
   
  
<!--end of wrap-->
</div>
    
<!--end of allwrap-->
</div>
<div id="footerwrap" class="gainlayout" style="width:1030px;"> 
  <div id="footer" class="gainlayout">  
         </div>
   
</div>



</div></body></html>